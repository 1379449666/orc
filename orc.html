<!--
 * @Author: wangChao
 * @Date: 2021-01-18 09:07:32
 * @LastEditTime: 2021-01-18 19:39:52
 * @LastEditors: wangChao
 * @Description: 
 * @FilePath: /vue-h5-template-vue-h5-template/orc.html
 * @我家门前有两棵树，一棵是枣树，另一棵也是枣树。
-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- import CSS -->
  <link rel="stylesheet" href="./js/element-ui.css">
</head>
<body>
  <div id="app">
    <!-- <el-tooltip class="item" effect="dark" content="只能上传xls/xlsx文件" placement="bottom-start"> -->
      <el-upload
        class="upload-demo"
        drag
        accept=".xls, .xlsx"
        :show-file-list="false"
        :on-change="handleChange"
        :auto-upload="false"
        action="https://www.zppinc.com/filter/upload.php"
        >
        <i class="el-icon-upload"></i>
        <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
        <el-button type="primary" slot="tip" :disabled="list.length==0">{{list.length > 0 ? list[0].name : ''}}上传</el-button>
        <el-button slot="tip" type="primary" @click="add" class="_add_button">添加单个违规关键字</el-button>
    </el-upload>
    <!-- </el-tooltip> -->
    <el-table :data="tableData" height="calc(100% - 125px - 87px)" border style="width: 100%">
      <el-table-column prop="date" type="index" label="序号" align="center" width="180"></el-table-column>
      <el-table-column prop="name" label="违规关键字" align="center">
        <template slot-scope="scope">
          <span>{{scope.row}}</span>
        </template>
      </el-table-column>
      <el-table-column prop="name" label="操作" align="center">
        <template slot-scope="scope">
          <el-button size="mini" type="danger" @click="handleDelete(scope.$index, scope.row)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
    <el-pagination
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
      :current-page="currentPage"
      :page-sizes="[100, 200, 300, 400]"
      :page-size="100"
      layout="total, sizes, prev, pager, next, jumper"
      :total="4000">
    </el-pagination>
  </div>
</body>
<!-- import Vue before Element -->
<script src="./js/vue.js"></script>
<!-- import JavaScript -->
<script src="./js/element-ui.js"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<script>
  new Vue({
    el: '#app',
    data: function() {
      return { 
        visible: false,
        fileList: [],
        list: [],
        currentPage: 1,
        tableData: []
      }
    },
    mounted() {
      this.getData()
    },
    methods: {
      add(index) {
        this.$prompt('请输入违规关键字', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          inputValidator(value){
            if (value == undefined) return '关键字不能为空'
          }
        }).then(({ value }) => {
          let params = new URLSearchParams()
          params.append('act', 2)
          params.append('keywords', value)
          axios.post('https://www.zppinc.com/filter/filter_edit.php', params)
          .then(res => {
            if (res.data.code != 200) return this.$message({ type: 'error', message: '添加失败！' });
            this.tableData = res.data.result.list
            console.log(this.list)
          this.$message({ type: 'success', message: '添加成功！' });
          })
        }).catch(() => {});
      },
      submitUpload() {
        this.$refs.upload.submit();
      },
      handleRemove(file, fileList) {
        console.log(file, fileList);
      },
      handlePreview(file) {
        console.log(file);
      },
      getData () {
        axios.post('https://www.zppinc.com/filter/filter_edit.php')
          .then(res => {
            this.tableData = res.data.result.list
            console.log(this.list)
          })
      },
      handleDelete (index, row) {
        this.$confirm(`删除关键字-${row}, 是否继续?`, '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          this.set_text(value)
        }).catch(() => {});
      },
      handleChange (file, fileList) {
        console.log(file, fileList)
        this.list.length = 0
        this.list = fileList
      },
      handleSizeChange(val) {
        console.log(`每页 ${val} 条`);
      },
      handleCurrentChange(val) {
        console.log(`当前页: ${val}`);
      },
      set_text (value) {
        let param = new URLSearchParams()
        param.append('act', 3)
        param.append('keywords', value)
        console.log(111)
        axios.post('https://www.zppinc.com/filter/filter_edit.php', param).then(res => {
          if (res.data.code != 200) return this.$message({ type: 'error', message: '删除失败！' });
          this.tableData = res.data.result.list
          console.log(this.list)
          this.$message({ type: 'success', message: '删除成功' });
        })
      }
    }
  })
</script>
<style>
* {
  padding: 0;
  margin: 0;
  box-sizing: border-box;
}
html, body, #app {
  height: 100%;
}
#app {
  padding: 20px;
}
.el-upload-dragger {
  height: 100px;
  width: 236px;
}
.el-upload-dragger .el-icon-upload {
  margin-top: 5px;
}
.upload-demo {
  padding-left: 200px;
  width: 30%;
  position: relative;
  margin-bottom: 20px;
  display: inline-block;
}
.upload-demo button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: 465px;
}
.el-pagination {
  text-align: end;
  margin: 20px 0;
}
.upload-demo ._add_button {
  left: 0;
}
</style>
</html>